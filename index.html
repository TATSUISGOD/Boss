<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚¿ãƒƒãƒ—RPG å®Œå…¨ç‰ˆ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{background:#111;color:#fff;font-family:sans-serif;text-align:center;margin:0;padding:15px}
button{font-size:16px;padding:12px 20px;margin:4px}
#tapBtn{font-size:26px;padding:28px 60px}
.hidden{display:none!important}
.boss{font-size:80px}
.hp-bar{width:80%;height:18px;background:#333;margin:10px auto;border-radius:10px}
.hp{height:100%;background:red}
.overlay{
 position:fixed;inset:0;background:rgba(0,0,0,.9);
 display:flex;justify-content:center;align-items:center;
 font-size:20px;z-index:999;text-align:center;padding:20px;overflow:auto
}
.spin{font-size:80px;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

/* å›³é‘‘ï¼ˆæ¨ªä¸¦ã³ï¼‰ */
.dex-grid{
 display:flex;
 flex-wrap:wrap;
 gap:10px;
 justify-content:center;
}
.dex-item{
 background:#222;
 padding:10px;
 border-radius:8px;
 min-width:120px;
}
</style>
</head>
<body>

<h1>ğŸ”¥ ã‚¿ãƒƒãƒ—RPG ğŸ”¥</h1>
<p>ğŸ’° <span id="coin"></span> / ğŸ’ <span id="dia"></span></p>
<p>âš” æ”»æ’ƒåŠ› +<span id="atk"></span></p>

<button onclick="drawGacha()">ğŸ°</button>
<button onclick="drawGacha10()">ğŸ°10</button>
<button onclick="drawDiaGacha()">ğŸ’</button>
<button onclick="drawDiaGacha10()">ğŸ’10</button>
<button onclick="showDex()">ğŸ“– å›³é‘‘</button>

<hr>

<button id="rushBtn" onclick="startRush()">ğŸ”¥ ãƒœã‚¹ãƒ©ãƒƒã‚·ãƒ¥ ğŸ”¥</button>

<div id="select">
  <button onclick="startBattle('ã‚¹ãƒ©ã‚¤ãƒ ',100,'ğŸŸ¢',10)">ã‚¹ãƒ©ã‚¤ãƒ </button>
  <button onclick="startBattle('ã‚ªãƒ¼ã‚¯',300,'ğŸ‘¹',20)">ã‚ªãƒ¼ã‚¯</button>
  <button onclick="startBattle('ãƒ‰ãƒ©ã‚´ãƒ³',800,'ğŸ‰',50)">ãƒ‰ãƒ©ã‚´ãƒ³</button>
  <button onclick="startBattle('ç¥ç«œ',5000,'ğŸ²âœ¨',500)">ç¥ç«œ</button>
</div>

<div id="game" class="hidden">
  <h2 id="bossName"></h2>
  <div class="boss" id="bossIcon"></div>
  <div class="hp-bar"><div class="hp" id="hp"></div></div>
  <p>HP <span id="hpText"></span></p>
  <button id="tapBtn">æ”»æ’ƒ</button>
</div>

<div id="overlay" class="overlay hidden"></div>

<script>
/* ===== ä¿å­˜ãƒ‡ãƒ¼ã‚¿ ===== */
let coin=+localStorage.getItem("coin")||0;
let dia=+localStorage.getItem("dia")||0;
let atk=+localStorage.getItem("atk")||0;
let dex=JSON.parse(localStorage.getItem("dex")||"{}");

const coinEl=document.getElementById("coin");
const diaEl=document.getElementById("dia");
const atkEl=document.getElementById("atk");
const overlay=document.getElementById("overlay");

function save(){
 localStorage.setItem("coin",coin);
 localStorage.setItem("dia",dia);
 localStorage.setItem("atk",atk);
 localStorage.setItem("dex",JSON.stringify(dex));
 coinEl.textContent=coin;
 diaEl.textContent=dia;
 atkEl.textContent=atk.toFixed(1);
}
save();

/* ===== overlay ===== */
function show(html,time=3000){
 overlay.innerHTML=html;
 overlay.classList.remove("hidden");
 if(time) setTimeout(()=>overlay.classList.add("hidden"),time);
}

/* ===== æ¼”å‡º ===== */
function anim(cb){
 show('<div class="spin">ğŸ°</div>',null);
 setTimeout(()=>{overlay.classList.add("hidden");cb();},1200);
}

/* ===== ã‚¬ãƒãƒ£ ===== */
function normalRoll(){
 const r=Math.random()*100;
 if(r<2)return["LR",1.5];
 if(r<7)return["UR",1];
 if(r<22)return["HR",0.5];
 return["R",0.1];
}

function drawGacha(){
 if(coin<100)return show("ã‚³ã‚¤ãƒ³ä¸è¶³");
 coin-=100; save();
 anim(()=>{
  const g=normalRoll();
  atk+=g[1];
  dex[g[0]]=(dex[g[0]]||0)+1;
  save();
  show(`${g[0]} +${g[1]}`);
 });
}

function drawGacha10(){
 if(coin<1000)return show("ã‚³ã‚¤ãƒ³ä¸è¶³");
 coin-=1000; save();
 anim(()=>{
  let html="<h3>ğŸ°10é€£çµæœ</h3>";
  for(let i=0;i<10;i++){
   const g=normalRoll();
   atk+=g[1];
   dex[g[0]]=(dex[g[0]]||0)+1;
   html+=`<div>${i+1}. ${g[0]} +${g[1]}</div>`;
  }
  save();
  show(html,4500);
 });
}

/* ===== ãƒ€ã‚¤ãƒ¤ã‚¬ãƒãƒ£ ===== */
function diaRoll(){
 const r=Math.random()*100;
 if(r<15)return["DIVINE",10];
 if(r<60)return["UR",1];
 return["LR",1.5];
}

function drawDiaGacha(){
 if(dia<1)return show("ãƒ€ã‚¤ãƒ¤ä¸è¶³");
 dia--; save();
 anim(()=>{
  const g=diaRoll();
  atk+=g[1];
  dex[g[0]]=(dex[g[0]]||0)+1;
  save();
  show(`ğŸ’ ${g[0]} +${g[1]}`);
 });
}

function drawDiaGacha10(){
 if(dia<10)return show("ãƒ€ã‚¤ãƒ¤ä¸è¶³");
 dia-=10; save();
 anim(()=>{
  let html="<h3>ğŸ’10é€£çµæœ</h3>";
  for(let i=0;i<10;i++){
   const g=diaRoll();
   atk+=g[1];
   dex[g[0]]=(dex[g[0]]||0)+1;
   html+=`<div>${i+1}. ${g[0]} +${g[1]}</div>`;
  }
  save();
  show(html,5000);
 });
}

/* ===== å›³é‘‘ ===== */
function showDex(){
 let h="<h2>ğŸ“– å›³é‘‘</h2><div class='dex-grid'>";
 for(let k in dex){
  h+=`<div class="dex-item">${k}<br>Ã—${dex[k]}</div>`;
 }
 h+="</div>";
 show(h,4000);
}

/* ===== ãƒãƒˆãƒ« ===== */
let bossHp,maxHp,reward,startTime;
function startBattle(n,h,i,r){
 rushMode=false;
 document.getElementById("rushBtn").classList.remove("hidden");
 document.getElementById("select").classList.add("hidden");
 document.getElementById("game").classList.remove("hidden");
 bossName.textContent=n;
 bossIcon.textContent=i;
 bossHp=maxHp=h;
 reward=r;
 startTime=Date.now();
 updateHp();
}

function updateHp(){
 hpText.textContent=Math.ceil(bossHp);
 hp.style.width=(bossHp/maxHp*100)+"%";
}

tapBtn.onclick=()=>{
 bossHp-=1+atk;
 updateHp();
 if(bossHp<=0){
  coin+=reward;
  save();
  game.classList.add("hidden");
  select.classList.remove("hidden");
  show(`ğŸ‰ æ’ƒç ´ï¼<br>ğŸ’° +${reward}`);
 }
};

/* ===== ãƒœã‚¹ãƒ©ãƒƒã‚·ãƒ¥ ===== */
let rushMode=false;
let rushEnd=0;
let rushCount=0;

const rushBosses=[
 ["ã‚¹ãƒ©ã‚¤ãƒ ",200,"ğŸŸ¢",50],
 ["ã‚ªãƒ¼ã‚¯",600,"ğŸ‘¹",120],
 ["ãƒ‰ãƒ©ã‚´ãƒ³",2000,"ğŸ‰",300],
 ["ç¥ç«œ",10000,"ğŸ²",1000]
];

function startRush(){
 rushMode=true;
 rushCount=0;
 rushEnd=Date.now()+60000;
 rushBtn.classList.add("hidden");
 select.classList.add("hidden");
 nextRushBoss();
 rushTick();
}

function nextRushBoss(){
 const b=rushBosses[Math.floor(Math.random()*rushBosses.length)];
 startBattle(b[0],b[1],b[2],b[3]);
}

function rushTick(){
 if(!rushMode)return;
 if(Date.now()>rushEnd){
  rushMode=false;
  coin+=rushCount*1000;
  save();
  show(`ğŸ”¥ ãƒœã‚¹ãƒ©ãƒƒã‚·ãƒ¥çµ‚äº†<br>${rushCount}ä½“æ’ƒç ´<br>ğŸ’° +${rushCount*1000}`,4000);
  select.classList.remove("hidden");
  rushBtn.classList.remove("hidden");
  game.classList.add("hidden");
  return;
 }
 setTimeout(rushTick,500);
}
</script>
</body>
</html>
